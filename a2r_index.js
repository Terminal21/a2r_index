// Generated by CoffeeScript 1.3.3
/* A2R Index Server
*/

syslog = require('./lib/syslog').getInstance();

config = require('./lib/configloader').load('index.config');

SessionProvider = require('./lib/sessionProvider').SessionProvider;

express = require('express');
index_web = express.createServer();
index_web.set('view engine', 'jade');
index_web.use(express["static"](__dirname + '/public'));

session_provider = new SessionProvider('localhost', 27017);

index_web.get('/', function(req, res) {
  return session_provider.findAll(function(error, result) {
    return res.render('index', {
      locals: {
        ses: result
      }
    });
  });
});

index_web.listen(config['index_web_port']);

console.log('Server running');
syslog.log(syslog.LOG_INFO, 'starting index server on port ' + config['notify_server_port']);
